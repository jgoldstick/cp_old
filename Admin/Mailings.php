<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Fog Creek CityDesk 2.0.19" />
<meta name="citydesk" content="D60A1ACE/73" />
<title>Communicating Partners: Mailing Lists
</title>
<!-- MacDonald1php.html -->
<link rel="stylesheet" media="screen" type="text/css" href="../CSS/CP.css" />
<link rel="stylesheet" media="print" type="text/css" href="../CSS/Print.css" />
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<!-- extra1 holds id for menu item to be highlighted -->
<style type="text/css">
#SiteHome
 {
  background-color: pink;
  border-left: 3px solid #00f;
   }
</style>
<!-- extra1 holds id for menu item to be highlighted -->
<style type="text/css">

#Mailings {



  background-color: pink;
  border-bottom: 3px solid red;}
</style>

  

</head>
<body>
<div class="ContactInfo">
<address>
Dr. James MacDonald 
332 Mimring 
Columbus, Ohio 43202 
Phone/Fax 614 447-0768 
<a href="mailto:e-mail:macdonald.3@osu.edu">macdonald.3@osu.edu</a>
</address>
</div>
<div id="NewLogo1">
<p id="SiteName">Communicating Partners</p>
<p id="tag1">Dr. James D. MacDonald's Website</p>
<p id="tag2">Helping Parents Help Children.  Programs for Parents, Therapists &amp; Educators</p>
</div>
<div id="ServicesNav">
<ul>
<li><a id="MacDonaldStart" href="../Articles/MacDonaldStart.html">Overview</a>
</li>


<li><a id="ClinicalServices" href="../Articles/ClinicalServices.html">Clinical Services</a>
</li>


<li><a id="CommunityEducation" href="../Articles/CommunityEducation.html">Community Education</a>
</li>


<li><a id="AboutDrMacDonald" href="../Articles/AboutDrMacDonald.html">About</a>
</li>


<li><a id="ContactUs" href="../Articles/ContactUs.html">Contact Us</a>
</li>


</ul>
<br />
</div>
<div id="sitenav">
<h4>Information on the Website</h4>
<ul>

<li><a id="FAQs" href="../Articles/FAQs.html">FAQs: Frequently Asked Questions</a>
</li>

<li><a id="Research" href="../Articles/Research.html">The Research Studies</a>
</li>

<li><a id="Autism" href="../Articles/Autism.html">Articles on Autism</a>
</li>

<li><a id="DownSyndrome" href="../Articles/DownSyndrome.html">Articles On Down Syndrome</a>
</li>

<li><a id="TheARM" href="../Articles/TheARM.html">Introduction To the Adult-Child Relationship Map (ARM)</a>
</li>

<li><a id="SuccessStories" href="../Articles/SuccessStories.html">Success Stories</a>
</li>

<li><a id="OnlineDiscussionGroup" href="../Articles/OnlineDiscussionGroup.html">The Online Discussion Group</a>
</li>

<li><a id="youtube" href="../Articles/youtube.html">YouTube Videos from Dr. Jim</a>
</li>

<li><a id="AboutWebsite" href="../Articles/AboutWebsite.html">About the Website</a>
</li>

</ul>
</div>
<div id="sidebar">
<h4>More Materials Available from Communicating Partners</h4>
	<a id="Books" href="../Catalog/index.html">Books and Pamphlets</a>
	<a id="VideoTapes" href="../Video/index.html">Videos</a>
	<a id="AudioTapes" href="../Audio/index.html">Audio Tapes</a>
<h4>Workshops</h4>
<?php
	$path = $_SERVER[DOCUMENT_ROOT] . '/Events';
	set_include_path(get_include_path() . PATH_SEPARATOR . $path);
	include "EventMenu.php";
?>
	<a href= "../Events/TrainingWorkshops.html">About Training and Workshops Seminars</a>
<h4>Dr. MacDonald's Books</h4>	
<iframe
src="http://rcm.amazon.com/e/cm?t=communica0636-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0978832027&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000FF&amp;bc1=000000&amp;bg1=FFFFFF&amp;f=ifr"
style="width:120px;height:240px;" scrolling="no" marginwidth="0"
marginheight="0" frameborder="0"></iframe>
<iframe
src="http://rcm.amazon.com/e/cm?t=communica0636-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1843107589&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000FF&amp;bc1=000000&amp;bg1=FFFFFF&amp;f=ifr"
style="width:120px;height:240px;" scrolling="no" marginwidth="0"
marginheight="0" frameborder="0"></iframe>
<div style="width:118px;height:240px; border: 1px solid black; margin: 4px 0 0 0;">
<h5><a href="../Catalog/CommunicateWithYourChild.html" >Communicate With Your Child
<img src="../Images/cwyc.110px.height.jpg" alt="Book Cover" /></a></h5>
<!--
<h4>Dr. MacDonald's new book: Communicating Partners: 30 Years of Building Responsive Relationships with Late-Talking Children</h4>
<script language="JavaScript" type="text/javascript">
function popUp(URL,NAME) {
amznwin=window.open(URL,NAME,"location=yes,scrollbars=yes,status=yes,toolbar=yes,resizable=yes,width=380,height=450,screenX=10,screenY=10,top=10,left=10");
amznwin.focus();}
document.open();
document.write("<a href=javascript:popUp(\"http://buybox.amazon.com/exec/obidos/redirect?tag=communica0636-20&link_code=qcb&creative=23424&camp=2025&path=/dt/assoc/tg/aa/xml/assoc/-/1843107589/communica0636-20/ref%3Dac_bb6_\",\"_amazon\")><img src=http://rcm-images.amazon.com/images/G/01/associates/remote-buy-box/buy6.gif border=0 alt='Buy from Amazon.com' /><\/a>");
document.close();
</script>
<noscript>
<form method="post" action="http://buybox.amazon.com/o/dt/assoc/handle-buy-box=1843107589">
<input type="hidden" name="asin.1843107589" value="1" />
<input type="hidden" name="tag-value" value="communica0636-20" />
<input type="hidden" name="tag_value" value="communica0636-20" />
<input type="image" name="submit.add-to-cart" value="Buy from Amazon.com" alt="Buy from Amazon.com" src="http://rcm-images.amazon.com/images/G/01/associates/add-to-cart.gif" />
</form>
</noscript>
-->
</div>
</div>
<div id="entry">
<h2>Mailing Lists</h2>
<?php
include_once ("../db/connect.php");

$sql = "SELECT `ListID`, `ListName` from listname";

$result = mysql_query("$sql");
if (!$result){
	echo "can't do sql: $sql";
	$en = mysql_errno();
	$e =  mysql_error();
	echo "$en: $e";
}
while ($row = mysql_fetch_array($result,  MYSQL_ASSOC)){
	$ListName[$row['ListID']] = $row['ListName'];
}
//print_r($ListName);
switch ($_POST['step']){
	case "1":
?>

<?php
		$lnum = $_POST['ListNum'];
		echo "<p>You are about to send $_POST[FileName]
			to the Recipients in the list: $ListName[$lnum] ($lnum)
			with the Subject: $_POST[Subject]</p>\n
			";

?>

		<form action="" method="POST"><fieldset><legend>Send the Announcement!</legend>
		<input type="hidden" name="ListNum" value = "<?php echo "$_POST[ListNum]"; ?>">
		<input type="hidden" name="Subject" value = "<?php echo "$_POST[Subject]"; ?>">
		<input type="hidden" name="FileName" value = "<?php echo "$_POST[FileName]"; ?>">
		<input type="submit" value="Send It" name="submitSendAnnouncement" />
		<input type="hidden" name="step" value="2">
		</fieldset>
		</form>
		<form action="" method="POST"><fieldset><Legend>Don't Send The announcement</legend>
		<input type="hidden" step="">
		<input type="submit" name="submit" value="I changed my mind">
		</fieldset>
		</form>

<?php
		break;
	case "2":
		$lNumber = $_POST['ListNum']; $slN = strlen($lNumber);
		$fMessage = $_POST['FileName']; $sFM = strlen($fMessage);
		$Subject = $_POST['Subject'];
		$body = file_get_contents("/home/cp/www/MailingFiles/$fMessage");
//echo "$lNumber, $fMessage, $Subject $body";
		SendMailing("inquiries@jamesdmacdonald.org", $Subject, $body, $lNumber);
echo "<h3>Sent it!!!!!!!!!!!!!!!!!</h3>";
?>
<?php
		break;
	case "3":
		break;
	default:
?>
		<h3>Instructions</h3>
		<ol>
		<li>Choose the file you wish to mail to your mailing list</li>
		<li>Choose which list to send it to</li>
		<li>Type in the subject line for the mailing</li>
		<li>When you have completed the form, press continue</li>
		</ol>
		<p>If you don't see the file you want to send in the list, 
		<a href="PHPUploadFile.php">copy it to the website first</a>
		</p>
		
		<form method ="POST" action="" name="formSelectFile">
		<fieldset><legend>Set up for Mass Mailing</legend>
		<div class="row"><label for="FileName">File</label>

		<select size="0" name="FileName">
	
<?php
		$dir = "/home/cp/www/MailingFiles/";
		$dh  = opendir($dir);
		while (false !== ($filename = readdir($dh))) {
			$files[] = $filename;	
		$ext = substr(strtolower($filename), -4, 4);
		//echo "$ext";
			if ($ext == ".txt"){
				echo "<option>$filename</option>\n";
			}
		}
?>   
		</select>
		</div>		
		<div class="row">
		<label for="ListNum">List</label>
		<select size="0" name="ListNum">
<?php
		foreach ($ListName as $k => $v){
			echo "<option value=\"$k\">$v</option>";
		}
?>
		</select>
		</div>
		<div class="row">
		<label for="Subject">Subject</label>
		<input type="text" name="Subject"  value="A Message From Dr. MacDonald">
		</div>
		<input type="submit" value="Continue" name="submitSelectFile">
		<input type="hidden" name="step" value="1">

		</fieldset>
		</form>
<?php	
	break;
}
?>
<?php
// Get Email list

function SendMailing($from, $subject, $body, $listID){
include_once ("../scripts/clsMimeMail.php");


	$sql = "SELECT `FirstName`, `LastName`, `Email` "
		. "FROM `customer`, subscriber WHERE subscriber.ListId = '$listID' and subscriber.customerId = customer.id";

	$result = mysql_query("$sql");
	if (!$result){
		echo "can't do sql: $sql";
		$en = mysql_errno();
		$e =  mysql_error();
		echo "$en: $e";
		exit();
	}
	while ($row = mysql_fetch_array($result,  MYSQL_ASSOC)){
		$to = $row['Email'];
echo "$to<br>";
		$mailer = new clsMimeMailer($to,$from,$subject,$body);
		$mailer->send();
//echo "<br>Sending $body to $to, from $from, subject: $subject";
		unset($mailer);
	}
}

?>
</div>
<div id="footer" class="ContactInfo">
<address>
Dr. James MacDonald 
332 Mimring 
Columbus, Ohio 43202 
Phone/Fax 614 447-0768 
<a href="mailto:e-mail:macdonald.3@osu.edu">macdonald.3@osu.edu</a>
</address>
</div>
</body>
</html>
